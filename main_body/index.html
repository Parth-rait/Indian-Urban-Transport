<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sustainable Mobility in the Indian Metropolis</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Plotly.js -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&display=swap" rel="stylesheet">

    <!-- Chosen Palette: Warm Neutrals & Academic Tones -->
    <!-- Background: #FAFAF9 (Warm Grey/Stone) -->
    <!-- Primary Text: #1C1917 (Stone 900) -->
    <!-- Accents: 
         - Delhi (Metro): #C2410C (Burnt Orange)
         - Mumbai (Rail): #1E40AF (Indigo Blue)
         - Bangalore (Bus/Mix): #047857 (Emerald Green)
         - Charts: Muted variations of above
    -->

    <!-- Application Structure Plan:
        1. Hero Section: Sets the context of "Trickle-Down Mobility" vs "Transport Democracy".
        2. The City Comparative Engine (Interactive Dashboard): Allows users to toggle between the three city models. Updates text analysis and data visualization (Radar Chart) dynamically.
        3. The Econometric Proof (Deep Dive): Visualizes the regression and ML findings. Uses bar charts to show 'Feature Importance' (Reliability vs Cost).
        4. Environmental Impact Lab (Calculator): An interactive tool based on the Social Cost of Carbon ($86/tonne) logic. Users compare projects (Metro vs Bus vs Flyover).
        5. Policy Roadmap: Interactive cards summarizing the path forward.
        
        Rationale: This structure moves from the 'What' (City comparisons) to the 'Why' (Econometrics) and finally the 'Cost' (Environment), mirroring the logical flow of a research paper but allowing non-linear exploration.
    -->

    <!-- Visualization & Content Choices:
        - City Stats: Radar Chart (Chart.js) -> Best for comparing multi-dimensional variables (Ridership, Cost, Access, etc.) across 3 distinct entities.
        - Determinants of Ridership: Horizontal Bar Chart (Chart.js) -> Clearly ranks coefficients/feature importance from the ML models.
        - Social Cost Analysis: Grouped Bar Chart or Donut Chart (Chart.js) -> Visualizing the "Hidden Costs" (Externalities) vs Capital Costs.
        - Interaction: Click events on city tabs update the DOM. Input sliders/dropdowns for the Environmental Calculator to update charts in real-time.
        - NO SVG/Mermaid used. Layout relies on Tailwind Grid/Flex.
    -->

    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FAFAF9; /* Stone 50 */
            color: #1C1917; /* Stone 900 */
        }
        h1, h2, h3, h4 {
            font-family: 'Merriweather', serif;
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            height: 400px;
            max-height: 500px;
        }
        @media (max-width: 768px) {
            .chart-container {
                height: 300px;
            }
        }
        .tab-active {
            border-bottom: 3px solid #44403C;
            font-weight: 700;
            color: #1C1917;
        }
        .tab-inactive {
            color: #78716C;
            border-bottom: 3px solid transparent;
        }
        .tab-inactive:hover {
            color: #44403C;
        }
        /* Custom scrollbar for text blocks if needed */
        .custom-scroll::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #a8a29e;
            border-radius: 3px;
        }
    </style>
</head>
<body class="antialiased selection:bg-stone-200">

    <!-- Navigation -->
    <nav class="sticky top-0 z-50 bg-[#FAFAF9]/95 backdrop-blur border-b border-stone-200 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <span class="text-xl font-bold font-serif text-stone-800 tracking-tight">Mobility<span class="text-stone-500">Divide</span></span>
                </div>
                <div class="hidden md:flex space-x-8 items-center text-sm font-medium text-stone-600">
                    <a href="#overview" class="hover:text-stone-900 transition">Overview</a>
                    <a href="#cities" class="hover:text-stone-900 transition">City Models</a>
                    <a href="#econometrics" class="hover:text-stone-900 transition">The Math</a>
                    <a href="#environment" class="hover:text-stone-900 transition">Social Cost</a>
                    <a href="#policy" class="hover:text-stone-900 transition">Roadmap</a>
                </div>
                <!-- Mobile menu button (functional via JS) -->
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-btn" class="text-stone-600 focus:outline-none">
                        <span class="text-2xl">☰</span>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu Dropdown -->
        <div id="mobile-menu" class="hidden md:hidden bg-stone-50 border-t border-stone-200">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3">
                <a href="#overview" class="block px-3 py-2 text-base font-medium text-stone-700 hover:bg-stone-200 rounded">Overview</a>
                <a href="#cities" class="block px-3 py-2 text-base font-medium text-stone-700 hover:bg-stone-200 rounded">City Models</a>
                <a href="#econometrics" class="block px-3 py-2 text-base font-medium text-stone-700 hover:bg-stone-200 rounded">The Math</a>
                <a href="#environment" class="block px-3 py-2 text-base font-medium text-stone-700 hover:bg-stone-200 rounded">Social Cost</a>
                <a href="#policy" class="block px-3 py-2 text-base font-medium text-stone-700 hover:bg-stone-200 rounded">Roadmap</a>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <header id="overview" class="pt-16 pb-12 sm:pt-24 sm:pb-16 bg-gradient-to-b from-stone-100 to-[#FAFAF9]">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h1 class="text-4xl sm:text-5xl md:text-6xl font-bold text-stone-900 mb-6 leading-tight">
                Sustainable Mobility in the <br/><span class="text-stone-600">Indian Metropolis</span>
            </h1>
            <p class="mt-4 text-xl text-stone-600 max-w-3xl mx-auto leading-relaxed">
                A comparative econometric analysis of Delhi, Mumbai, and Bangalore. Exploring the "Trickle-Down" mobility myth, the "Anil Kumble" resilience of legacy rail, and the illusion of inclusion in modern transport architecture.
            </p>
            <div class="mt-8 flex justify-center gap-4">
                <button onclick="document.getElementById('cities').scrollIntoView({behavior: 'smooth'})" class="px-8 py-3 bg-stone-900 text-white font-medium rounded-full hover:bg-stone-700 transition shadow-lg">
                    Explore the Data
                </button>
            </div>
        </div>
    </header>

    <!-- Introduction / Problem Statement -->
    <section class="py-12 bg-white border-y border-stone-200">
        <div class="max-w-4xl mx-auto px-4 sm:px-6">
            <h2 class="text-3xl font-serif font-bold text-stone-800 mb-6">The Illusion of Inclusion</h2>
            <div class="prose prose-stone prose-lg mx-auto text-stone-600">
                <p>
                    India's urban transport architecture operates on a paradigm of <strong>"trickle-down" modernization</strong>. Just as the banking sector historically prioritized institutions over the unbanked, transport planning has favored capital-intensive Metro projects under the assumption that world-class infrastructure will inevitably reorganize urban chaos.
                </p>
                <p class="mt-4">
                    However, this report argues that growth has not been inclusive. While Metro networks expand, millions remain dependent on crumbling bus networks or unsafe intermediate transport. This study uses <strong>Econometrics, Machine Learning, and Environmental Economics</strong> to dismantle the "trickle-down" myth and propose a "Power-Divided" framework that democratizes access.
                </p>
            </div>
            <div class="mt-10 grid grid-cols-1 md:grid-cols-2 gap-8">
                <div class="bg-stone-50 p-6 rounded-xl border border-stone-200">
                    <h3 class="text-lg font-bold text-stone-800 mb-2">Trickle-Down Mobility</h3>
                    <p class="text-sm text-stone-600">Top-down planning. High capital expenditure. Prioritizes the "formal" economy (Metro) hoping for decongestion. Often creates exclusion through high fares.</p>
                </div>
                <div class="bg-stone-50 p-6 rounded-xl border border-stone-200">
                    <h3 class="text-lg font-bold text-stone-800 mb-2">Transport Democracy</h3>
                    <p class="text-sm text-stone-600">Participatory planning. Diverse modes (Bus + Rail). Prioritizes the "captive" user. Focuses on total social welfare and last-mile connectivity.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 2: THE THREE CITIES DASHBOARD -->
    <section id="cities" class="py-16 bg-[#FAFAF9]">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="mb-10 text-center">
                <h2 class="text-3xl font-serif font-bold text-stone-900">A Tale of Three Cities</h2>
                <p class="mt-4 text-stone-600 max-w-2xl mx-auto">
                    Comparing institutional architectures and performance metrics. Click on a city to analyze its specific model, data, and structural challenges.
                </p>
            </div>

            <!-- City Tabs -->
            <div class="flex justify-center border-b border-stone-300 mb-8">
                <button class="city-tab tab-active px-6 py-3 text-lg focus:outline-none transition-colors" data-city="delhi" onclick="switchCity('delhi')">Delhi (Planned)</button>
                <button class="city-tab tab-inactive px-6 py-3 text-lg focus:outline-none transition-colors" data-city="mumbai" onclick="switchCity('mumbai')">Mumbai (Legacy)</button>
                <button class="city-tab tab-inactive px-6 py-3 text-lg focus:outline-none transition-colors" data-city="bangalore" onclick="switchCity('bangalore')">Bangalore (Siloed)</button>
            </div>

            <!-- Dynamic Content Area -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
                <!-- Left Col: Text Analysis -->
                <div class="lg:col-span-5 space-y-6">
                    <div id="city-content" class="bg-white p-8 rounded-2xl shadow-sm border border-stone-200 h-full flex flex-col justify-between">
                        <!-- Content injected via JS -->
                        <div>
                            <h3 id="city-title" class="text-2xl font-bold text-stone-800 mb-2">Delhi: The Metro-First Model</h3>
                            <div id="city-badges" class="flex flex-wrap gap-2 mb-4">
                                <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs font-semibold rounded">High Capital</span>
                                <span class="px-2 py-1 bg-orange-100 text-orange-800 text-xs font-semibold rounded">Centralized SPV</span>
                            </div>
                            <p id="city-desc" class="text-stone-600 leading-relaxed">
                                The DMRC operates like a large Public Sector Bank—efficient but rigid. It has achieved "world-class" standards but faces a "Last Mile" crisis. While it carries 4.6 million daily, the high fare structure (₹60+) creates exclusion similar to dormant bank accounts. The illusion of connectivity masks the reality that road congestion remains severe.
                            </p>
                        </div>
                        <div class="mt-6 pt-6 border-t border-stone-100">
                            <h4 class="font-bold text-stone-800 mb-3">Key Structural Insight</h4>
                            <p id="city-insight" class="text-sm text-stone-500 italic">
                                "Network density is high, but the 'transfer penalty' discourages short trips. It functions as a premium service for the middle class rather than a universal utility."
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Right Col: Data Visualization -->
                <div class="lg:col-span-7 space-y-6">
                    <!-- Key Metrics Cards -->
                    <div class="grid grid-cols-3 gap-4">
                        <div class="bg-white p-4 rounded-xl border border-stone-200 text-center shadow-sm">
                            <div class="text-xs text-stone-500 uppercase tracking-wide">Daily Ridership</div>
                            <div id="stat-ridership" class="text-2xl font-bold text-stone-800 mt-1">4.6 M</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-stone-200 text-center shadow-sm">
                            <div class="text-xs text-stone-500 uppercase tracking-wide">Avg Cost (User)</div>
                            <div id="stat-cost" class="text-2xl font-bold text-stone-800 mt-1">₹35</div>
                        </div>
                        <div class="bg-white p-4 rounded-xl border border-stone-200 text-center shadow-sm">
                            <div class="text-xs text-stone-500 uppercase tracking-wide">Efficiency</div>
                            <div id="stat-efficiency" class="text-2xl font-bold text-stone-800 mt-1">High</div>
                        </div>
                    </div>

                    <!-- Chart Container -->
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200">
                        <h4 class="text-sm font-bold text-stone-400 uppercase mb-4 tracking-wider">Comparative Performance Radar</h4>
                        <div class="chart-container h-80">
                            <canvas id="cityRadarChart"></canvas>
                        </div>
                        <div class="mt-2 text-xs text-center text-stone-400">
                            *Values normalized for comparison (1-10 Scale). Source: Report Table 1 & 2.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 3: ECONOMETRICS -->
    <section id="econometrics" class="py-16 bg-white border-t border-stone-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-center">
                
                <!-- Text Content -->
                <div>
                    <h2 class="text-3xl font-serif font-bold text-stone-900 mb-6">The Econometric Proof</h2>
                    <p class="text-stone-600 text-lg mb-6">
                        Using <strong>Multilevel Regression</strong> and <strong>CatBoost</strong> machine learning models, we isolated the hidden determinants of ridership. The data reveals that commuters are not just cost-minimizers; they are <em>risk-minimizers</em>.
                    </p>
                    
                    <div class="space-y-6">
                        <div class="pl-4 border-l-4 border-stone-800">
                            <h3 class="font-bold text-lg text-stone-800">The "Anil Kumble" Effect (Mumbai)</h3>
                            <p class="text-stone-600 mt-1">
                                Regression shows demand is inelastic to fare. The dominant predictor is the 'City Effect'. The system delivers the result (arrival) despite 'Low Comfort'. It is a non-discretionary "workhorse".
                            </p>
                        </div>
                        <div class="pl-4 border-l-4 border-stone-300">
                            <h3 class="font-bold text-lg text-stone-800">The Reliability Premium (Delhi)</h3>
                            <p class="text-stone-600 mt-1">
                                CatBoost identifies "Travel Time Reliability" (Variance) as the #1 predictor. Users pay a premium to avoid the uncertainty of road traffic, even if the Metro takes longer in total.
                            </p>
                        </div>
                        <div class="pl-4 border-l-4 border-stone-300">
                            <h3 class="font-bold text-lg text-stone-800">The Price Gate (Bangalore)</h3>
                            <p class="text-stone-600 mt-1">
                                A strong negative interaction between Cost and Ridership. High fares act as a gatekeeper, forcing 'transport literate' but poor users onto slower buses.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Visualization -->
                <div class="bg-stone-50 p-6 rounded-2xl border border-stone-200 shadow-inner">
                    <h3 class="text-lg font-bold text-stone-800 mb-4">Determinants of Mode Choice (Feature Importance)</h3>
                    <p class="text-sm text-stone-500 mb-4">Relative importance of factors influencing a commuter's decision to switch to public transport.</p>
                    <div class="chart-container">
                        <canvas id="econometricsChart"></canvas>
                    </div>
                    <div class="mt-4 p-4 bg-white rounded-lg border border-stone-200">
                        <p class="text-sm text-stone-600 italic">
                            <strong>Insight:</strong> "Reliability" (Low Variance) outweighs "Comfort". A system must function like a guaranteed return fund to attract users from private vehicles.
                        </p>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- SECTION 4: ENVIRONMENTAL ECONOMICS -->
    <section id="environment" class="py-16 bg-[#FAFAF9] border-t border-stone-200">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-10">
                <h2 class="text-3xl font-serif font-bold text-stone-900">Social Cost Calculator</h2>
                <p class="mt-4 text-stone-600">
                    Applying the <strong>Social Cost of Carbon (SCC)</strong> at $86/tonne (approx ₹7,000). 
                    True project appraisal must account for externalities: congestion, pollution, and carbon debt.
                </p>
            </div>

            <!-- The Calculator Tool -->
            <div class="bg-white rounded-2xl shadow-lg border border-stone-200 overflow-hidden">
                <div class="grid grid-cols-1 md:grid-cols-12 divide-y md:divide-y-0 md:divide-x divide-stone-200">
                    
                    <!-- Controls -->
                    <div class="md:col-span-4 p-8 bg-stone-50">
                        <h3 class="text-lg font-bold text-stone-800 mb-6">Project Appraisal Simulation</h3>
                        
                        <div class="space-y-6">
                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Select Transport Project</label>
                                <select id="project-select" class="block w-full pl-3 pr-10 py-2 text-base border-stone-300 focus:outline-none focus:ring-stone-500 focus:border-stone-500 sm:text-sm rounded-md bg-white shadow-sm border" onchange="updateEcoCalc()">
                                    <option value="metro">New Metro Line (Underground)</option>
                                    <option value="bus">Electric Bus Fleet (Rapid Deployment)</option>
                                    <option value="flyover">Road Flyover (Widening)</option>
                                </select>
                            </div>

                            <div>
                                <label class="block text-sm font-medium text-stone-700 mb-2">Projected Daily Users</label>
                                <input type="range" min="10000" max="500000" step="10000" value="100000" id="user-slider" class="w-full h-2 bg-stone-300 rounded-lg appearance-none cursor-pointer accent-stone-800" oninput="updateEcoCalc()">
                                <div class="flex justify-between text-xs text-stone-500 mt-1">
                                    <span>10k</span>
                                    <span id="user-display">100,000</span>
                                    <span>500k</span>
                                </div>
                            </div>
                        </div>

                        <div class="mt-8 p-4 bg-blue-50 rounded-lg border border-blue-100">
                            <h4 class="text-xs font-bold text-blue-800 uppercase">Logic</h4>
                            <p class="text-xs text-blue-700 mt-1">
                                <strong>Metro:</strong> High Capex, High Carbon Debt (construction), High Efficiency. <br/>
                                <strong>Bus:</strong> Low Capex, Immediate Benefit, High Flexibility. <br/>
                                <strong>Flyover:</strong> Moderate Capex, Induces Demand (Negative Social Value).
                            </p>
                        </div>
                    </div>

                    <!-- Results Visualization -->
                    <div class="md:col-span-8 p-8">
                        <div class="grid grid-cols-2 gap-6 mb-6">
                            <div class="text-center">
                                <p class="text-sm text-stone-500">Capital Carbon Debt</p>
                                <p id="val-carbon-debt" class="text-2xl font-bold text-stone-800">High</p>
                            </div>
                            <div class="text-center">
                                <p class="text-sm text-stone-500">Social NPV (Annual)</p>
                                <p id="val-social-npv" class="text-2xl font-bold text-green-700">$50M</p>
                            </div>
                        </div>
                        
                        <div class="chart-container h-64">
                            <canvas id="ecoChart"></canvas>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <p id="calc-verdict" class="text-stone-800 font-medium">Verdict: ...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION 5: ROADMAP -->
    <section id="policy" class="py-16 bg-white border-t border-stone-200">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-serif font-bold text-stone-900 mb-10 text-center">Policy Roadmap: Plural Mobility</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Card 1 -->
                <div class="group p-6 border border-stone-200 rounded-xl hover:shadow-lg transition-all duration-300 bg-stone-50">
                    <div class="w-12 h-12 bg-stone-900 text-white rounded-full flex items-center justify-center text-xl font-bold mb-4 group-hover:bg-stone-700 transition">1</div>
                    <h3 class="text-xl font-bold text-stone-800 mb-2">Bus-First Approach</h3>
                    <p class="text-stone-600 text-sm">
                        Shift focus from Metro-only to "Bus Modernization Funds". Double fleet sizes in Delhi & Bangalore. Buses are the "cooperatives" of transport—democratic and flexible.
                    </p>
                </div>

                <!-- Card 2 -->
                <div class="group p-6 border border-stone-200 rounded-xl hover:shadow-lg transition-all duration-300 bg-stone-50">
                    <div class="w-12 h-12 bg-stone-900 text-white rounded-full flex items-center justify-center text-xl font-bold mb-4 group-hover:bg-stone-700 transition">2</div>
                    <h3 class="text-xl font-bold text-stone-800 mb-2">Congestion Pricing</h3>
                    <p class="text-stone-600 text-sm">
                        Correct the distortion where cars occupy 80% of road space. Implement charges in CBDs and use revenue to subsidize public transport, making it the "economically rational" choice.
                    </p>
                </div>

                <!-- Card 3 -->
                <div class="group p-6 border border-stone-200 rounded-xl hover:shadow-lg transition-all duration-300 bg-stone-50">
                    <div class="w-12 h-12 bg-stone-900 text-white rounded-full flex items-center justify-center text-xl font-bold mb-4 group-hover:bg-stone-700 transition">3</div>
                    <h3 class="text-xl font-bold text-stone-800 mb-2">Integration (One Card)</h3>
                    <p class="text-stone-600 text-sm">
                        Mandatory integration of Metro and Bus ticketing. Remove the "transfer penalty". A feeder bus ride should be free with a Metro trip to solve the Last Mile connectivity gap.
                    </p>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="bg-stone-900 text-stone-400 py-12">
        <div class="max-w-7xl mx-auto px-4 text-center">
            <p class="mb-4 text-stone-100 font-serif text-lg">"The path forward is not just on the rails, but on the road."</p>
            <p class="text-sm">Based on the research report: <em>Sustainable Mobility in the Indian Metropolis: A Comparative Econometric and Environmental Analysis</em>.</p>
            <div class="mt-8 text-xs text-stone-600">
                Data synthesized from DMRC, Indian Railways, and BMRCL Reports. | Visualization generated for Educational Purposes.
            </div>
        </div>
    </footer>

    <!-- JavaScript Application Logic -->
    <script>
        // --- DATA STORE ---
        const cityData = {
            delhi: {
                title: "Delhi: The Metro-First Model",
                desc: "The DMRC operates as a technocratic giant. While it has achieved world-class operational standards, its fare structure creates exclusion. The 'illusion of connectivity' is strong: 390km of track exists, yet road congestion has not decreased proportionately. The system prioritizes long-distance stability over local accessibility.",
                badges: ["High Capital", "Centralized SPV", "Clean but Expensive"],
                insight: "\"Network density is high, but the 'transfer penalty' discourages short trips. It functions as a premium service for the middle class rather than a universal utility.\"",
                stats: { ridership: "4.6 M", cost: "₹35", efficiency: "High" },
                radar: [9, 4, 8, 5, 7] // [Ridership, Affordability (inv cost), Efficiency, LastMile, SocialWelfare]
            },
            mumbai: {
                title: "Mumbai: The Rail Backbone",
                desc: "The 'Anil Kumble' of transport: a workhorse that shoulders the entire burden. It operates on a model of 'mass movement at minimum cost' (₹5-10). It is the most inclusive system financially but exacts a heavy toll on human dignity through 'super-dense crush loads'. Geographically constrained, it is an accidental Transit-Oriented Development.",
                badges: ["Legacy System", "Mass Scale", "Low Cost"],
                insight: "\"The system maximizes Social Welfare mathematically through sheer volume and low energy per capita, despite the chronic lack of comfort.\"",
                stats: { ridership: "7.5 M", cost: "₹10", efficiency: "Max" },
                radar: [10, 10, 6, 8, 9] 
            },
            bangalore: {
                title: "Bangalore: The Siloed System",
                desc: "A city in transition, struggling with the friction between IT-driven growth and lagging infrastructure. Namma Metro and BMTC operate in silos. High Metro fares (up to ₹90) act as a price gate, effectively taxing 'transport literacy'. The bus fleet is overworked and neglected, leading to a system that reinforces social stratification.",
                badges: ["Fragmented", "High Fares", "Bus Neglect"],
                insight: "\"Lack of integration hurts the system most. The 'Bus-First' potential is high, but currently, the poor are priced out of the Metro and stuck in traffic on buses.\"",
                stats: { ridership: "4.8 M", cost: "₹45", efficiency: "Low" },
                radar: [5, 2, 5, 3, 4] 
            }
        };

        // --- CHART INSTANCES ---
        let radarChartInstance = null;
        let barChartInstance = null;
        let ecoChartInstance = null;

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            initRadarChart();
            initBarChart();
            initEcoChart(); // Initialize the calc chart
            updateEcoCalc(); // Run initial calculation
            
            // Mobile Menu Toggle
            const btn = document.getElementById('mobile-menu-btn');
            const menu = document.getElementById('mobile-menu');
            btn.addEventListener('click', () => {
                menu.classList.toggle('hidden');
            });
        });

        // --- CITY SWITCHER LOGIC ---
        function switchCity(cityKey) {
            const data = cityData[cityKey];
            
            // Update UI Text
            document.getElementById('city-title').textContent = data.title;
            document.getElementById('city-desc').textContent = data.desc;
            document.getElementById('city-insight').textContent = data.insight;
            document.getElementById('stat-ridership').textContent = data.stats.ridership;
            document.getElementById('stat-cost').textContent = data.stats.cost;
            document.getElementById('stat-efficiency').textContent = data.stats.efficiency;

            // Update Badges
            const badgeContainer = document.getElementById('city-badges');
            badgeContainer.innerHTML = '';
            data.badges.forEach(text => {
                const span = document.createElement('span');
                // Dynamic coloring based on city
                let colorClass = cityKey === 'delhi' ? 'bg-orange-100 text-orange-800' : 
                                 cityKey === 'mumbai' ? 'bg-blue-100 text-blue-800' : 
                                 'bg-green-100 text-green-800';
                span.className = `px-2 py-1 text-xs font-semibold rounded ${colorClass}`;
                span.textContent = text;
                badgeContainer.appendChild(span);
            });

            // Update Tabs Styling
            document.querySelectorAll('.city-tab').forEach(tab => {
                if(tab.dataset.city === cityKey) {
                    tab.classList.remove('tab-inactive');
                    tab.classList.add('tab-active');
                } else {
                    tab.classList.remove('tab-active');
                    tab.classList.add('tab-inactive');
                }
            });

            // Update Radar Chart
            updateRadarChart(data.radar, cityKey);
        }

        // --- CHART 1: RADAR (CITY COMPARISON) ---
        function initRadarChart() {
            const ctx = document.getElementById('cityRadarChart').getContext('2d');
            
            radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Ridership Volume', 'Affordability', 'Op. Efficiency', 'Last Mile Access', 'Social Welfare'],
                    datasets: [{
                        label: 'Delhi',
                        data: cityData.delhi.radar,
                        fill: true,
                        backgroundColor: 'rgba(194, 65, 12, 0.2)', // Orange
                        borderColor: 'rgb(194, 65, 12)',
                        pointBackgroundColor: 'rgb(194, 65, 12)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgb(194, 65, 12)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    elements: { line: { tension: 0.3 } },
                    scales: {
                        r: {
                            angleLines: { color: '#E7E5E4' },
                            grid: { color: '#E7E5E4' },
                            pointLabels: {
                                font: { size: 11, family: 'Inter' },
                                color: '#57534E'
                            },
                            suggestedMin: 0,
                            suggestedMax: 10,
                            ticks: { display: false } // Hide numbers on axis for cleaner look
                        }
                    },
                    plugins: {
                        legend: { display: false }
                    }
                }
            });
        }

        function updateRadarChart(newData, cityKey) {
            let color, bg;
            if (cityKey === 'delhi') { color = 'rgb(194, 65, 12)'; bg = 'rgba(194, 65, 12, 0.2)'; }
            else if (cityKey === 'mumbai') { color = 'rgb(30, 64, 175)'; bg = 'rgba(30, 64, 175, 0.2)'; }
            else { color = 'rgb(4, 120, 87)'; bg = 'rgba(4, 120, 87, 0.2)'; }

            radarChartInstance.data.datasets[0].data = newData;
            radarChartInstance.data.datasets[0].label = cityKey.charAt(0).toUpperCase() + cityKey.slice(1);
            radarChartInstance.data.datasets[0].borderColor = color;
            radarChartInstance.data.datasets[0].backgroundColor = bg;
            radarChartInstance.data.datasets[0].pointBackgroundColor = color;
            radarChartInstance.update();
        }

        // --- CHART 2: BAR (ECONOMETRICS) ---
        function initBarChart() {
            const ctx = document.getElementById('econometricsChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Reliability (Time Variance)', 'Total Travel Time', 'Access Cost (First Mile)', 'Comfort (Crowding)', 'Monetary Cost'],
                    datasets: [{
                        label: 'Impact on Mode Choice (Coefficient Strength)',
                        data: [0.85, 0.65, 0.60, 0.30, 0.25], // Synthetic representation of ML Feature Importance
                        backgroundColor: [
                            '#1C1917', // High Impact (Reliability)
                            '#44403C',
                            '#57534E',
                            '#78716C',
                            '#A8A29E'  // Low Impact (Cost - for Mumbai/Delhi average)
                        ],
                        borderRadius: 4
                    }]
                },
                options: {
                    indexAxis: 'y', // Horizontal bar
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { display: false, grid: { display: false } },
                        y: { 
                            grid: { display: false },
                            ticks: { font: { family: 'Inter' } }
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return 'Importance Score: ' + context.raw;
                                }
                            }
                        }
                    }
                }
            });
        }

        // --- CHART 3 & LOGIC: ENVIRONMENTAL CALCULATOR ---
        function initEcoChart() {
            const ctx = document.getElementById('ecoChart').getContext('2d');
            ecoChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Carbon Debt (Construction)', 'Annual Avoided Emissions'],
                    datasets: [{
                        label: 'Tonnes CO2e',
                        data: [0, 0],
                        backgroundColor: ['#dc2626', '#16a34a'] // Red for Debt, Green for Benefit
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    },
                    plugins: {
                        legend: { display: true }
                    }
                }
            });
        }

        function updateEcoCalc() {
            const project = document.getElementById('project-select').value;
            const users = document.getElementById('user-slider').value;
            
            // Update Slider Display
            document.getElementById('user-display').textContent = parseInt(users).toLocaleString();

            // Simplified Model Logic based on Table 3 and Text
            // Metrics: Construction Carbon (Tonnes), Annual Benefit (Tonnes)
            let carbonDebt, annualBenefit, verdictText, npvValue;

            if (project === 'metro') {
                // High Debt (Concrete/Steel), High Benefit (Efficiency)
                carbonDebt = users * 0.5; // Arbitrary unit for visualization scaling
                annualBenefit = users * 0.08; 
                verdictText = "High Capital Cost. Requires decades to offset carbon debt. Best for extremely high-density corridors.";
                npvValue = "Positive (Long-term)";
            } else if (project === 'bus') {
                // Low Debt, High Immediate Benefit
                carbonDebt = users * 0.05; 
                annualBenefit = users * 0.06; // Slightly less efficient per pkm than metro but huge scale
                verdictText = "The 'Winner'. Low initial debt, immediate positive cash flow of social welfare. Highly scalable.";
                npvValue = "Highest (Immediate)";
            } else {
                // Flyover: Moderate Debt, Negative Benefit (Induced Demand)
                carbonDebt = users * 0.2;
                annualBenefit = users * -0.02; // Negative because it induces car usage
                verdictText = "Policy Failure. Induces private vehicle demand. Negative Social NPV despite moderate cost.";
                npvValue = "Negative";
            }

            // Update DOM
            document.getElementById('val-carbon-debt').textContent = carbonDebt > 1000 ? "Very High" : (carbonDebt < 100 ? "Low" : "Moderate");
            document.getElementById('val-social-npv').textContent = npvValue;
            document.getElementById('calc-verdict').textContent = verdictText;

            // Update Chart
            ecoChartInstance.data.datasets[0].data = [carbonDebt, Math.max(0, annualBenefit)]; // Only show positive benefit in green bar
            // If benefit is negative (flyover), maybe show it differently, but for simplicity we zero it in chart and explain in text
            if(annualBenefit < 0) {
                 ecoChartInstance.data.datasets[0].backgroundColor = ['#dc2626', '#991b1b']; // Dark red for negative benefit logic if we plotted it, but here just sticking to bars
            } else {
                 ecoChartInstance.data.datasets[0].backgroundColor = ['#dc2626', '#16a34a'];
            }
            ecoChartInstance.update();
        }

    </script>
</body>
</html>